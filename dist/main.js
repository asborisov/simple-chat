!function(){HTMLElement.prototype.removeClass=function(e){var t=this.className.split(" "),n=t.filter(function(t){return t!=e});this.className=n.join(" ")},HTMLElement.prototype.addClass=function(e){var t=this.className.split(" ");t.push(e),this.className=t.join(" ")}}(),function(){"use strict";function e(){i=new WebSocket("ws://localhost:3000"),i.onmessage=function(e){try{var t=JSON.parse(e.data);switch(t.type){case"login":n(t);break;case"message":a(t.text,t.sender,t.timestamp);break;case"usersList":o(t.list)}}catch(s){console.log(s)}},i.onopen=function(){var e=window.localStorage.getItem("chatData");if(e)try{e=JSON.parse(e),t(e.login,e.guid)}catch(n){console.log(n),window.localStorage.removeItem("chatData")}},i.onclose=function(){alert("Lost connection. Try to re-login"),document.getElementById("publish").addClass("hidden"),document.getElementById("chat").addClass("hidden"),document.getElementById("loginForm").removeClass("hidden"),e()}}function t(e,t){if(e){var n=JSON.stringify({type:"login",guid:t,username:e});i.send(n)}}function n(e){if("ok"==e.status)window.localStorage.setItem("chatData",JSON.stringify({login:e.username,guid:e.guid})),document.getElementById("loginForm").addClass("hidden"),document.getElementById("publish").removeClass("hidden"),document.getElementById("chat").removeClass("hidden");else{for(var t=document.getElementById("loginForm").getElementsByClassName("error")[0];t.firstChild;)t.removeChild(t.firstChild);switch(e.code){case 1:t.appendChild(document.createTextNode("Login is already in use. Try to use another."));break;case 2:t.appendChild(document.createTextNode("User is already online."))}window.localStorage.removeItem("chatData"),console.log(e.code,e.message)}}function s(e){var t=JSON.stringify({type:"message",text:e});i.send(t)}function a(e,t,n){function s(e){return 10>e?"0"+e:""+e}function a(){var e=document.getElementsByClassName("messages")[0];e.scrollTop=e.scrollHeight}if(t&&n){var o=new Date;o.setTime(n),n=s(o.getDate())+"."+s(o.getMonth())+"."+s(o.getFullYear())+" "+s(o.getHours())+":"+s(o.getMinutes())+":"+s(o.getSeconds())}var i=document.createElement("div");if(i.addClass("message"),t){var d=document.createElement("div");d.addClass("sender"),d.appendChild(document.createTextNode(t+(n?" ["+n+"]":"")+": ")),i.appendChild(d)}var l=document.createElement("div");l.innerText=e,i.appendChild(l),document.getElementsByClassName("messages")[0].getElementsByClassName("list-wrapper")[0].appendChild(i),a()}function o(e){for(var t=document.getElementsByClassName("users")[0].getElementsByClassName("list-wrapper")[0];t.firstChild;)t.removeChild(t.firstChild);var n;e.forEach(function(e){n=document.createElement("div"),n.appendChild(document.createTextNode(e)),n.addClass("user"),t.appendChild(n)})}window.WebSocket||(document.body.innerHTML="WebSocket is not supported by your browser");var i;document.forms.login.onsubmit=function(){return t(this.login.value),!1},document.forms.publish.onsubmit=function(){return s(this.message.value),this.message.value="",!1},e()}();